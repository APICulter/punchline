<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vote</title>
</head>
<script src="/socket.io/socket.io.js"></script>
<body>

    <!-- <form> -->
        <div id="answers">

        </div>
        <br>
        <!-- <button id="vote" type="submit">Vote</button> -->
        <button id="vote">Vote</button>
    <!-- </form> -->

    
</body>

<script>
    const socket = io();
    // let punchlinePin;

    window.onload = function () {
			punchlinePin = sessionStorage.getItem("punchlinePin");
            socket.emit('getAnswers', { punchlinePin: punchlinePin });
		};
    
        socket.on('postAnswers', function (data) {
            //randomizer
            data.forEach(element => {
                let answerBlock = document.createElement('div');
                answerBlock.id = data.indexOf(element);
                
                let answer = document.createElement('input');
                answer.setAttribute("type", "radio");
                answer.id = element.playerName;
                answer.value = element.textAnswer;
                answer.name = 'answer';

                let label = document.createElement('label');
                label.textContent = element.textAnswer;
                label.setAttribute("for", answer.id);

                document.getElementById('answers').append(answerBlock);
                document.getElementById(answerBlock.id).append(answer);
                document.getElementById(answerBlock.id).append(label);
            });

            
        });

        // const form = document.querySelector("form");
        //envoyer juste l'id ou le nom du joueur plutot que la rÃ©ponse...
        const button = document.querySelector('#vote');
        button.addEventListener('click', function() {

            let answer = document.querySelector('input[name=answer]:checked').id;
            socket.emit('vote', answer, punchlinePin);
            // window.location = "/html/waiting.html";
            });

       socket.on('redirect', newGameURL => {
   			 // redirect to new URL
   			 window.location = newGameURL;
		});

</script>
</html>